<div class="container">
  <div class="box">

  <div class="col-lg-12">
      <hr>
      <h2 class="intro-text text-center">
          <strong>Users</strong>
      </h2>
      <hr>
  </div>


<%= link_to "All Users", :action => "index" %>
|
<%= link_to "Users awaiting approval", :action => "index", :approved => "false" %>
<br/><br/>
<table class="admin-table table" data-source="<%= users_path(format: :json) %>" style="display:none">
      <thead>
        <tr>
          <th>Email<div class="img-sorting"></div></th>
          <th>Role<div class="img-sorting"></div></th>
          <th>Status<div class="img-sorting"></div></th>
          <th>Created at<div class="img-sorting"></div></th>
          <th><%=t '.actions', :default => t("helpers.actions") %><div class="img-sorting"></div></th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
    </div>
    <div id="table-loading" style="display: none">
        <div id="loading-background" class="loading-overlay"><%= image_tag "ajax-loader.gif", :class => "loader spin center" %></div>
    </div>
  </main>
</div>
<% content_for :extra_js do %>
  <%= javascript_include_tag "datatables" %>
   <script>
   
  $(document).ready(function() { 
    var tableOptions = createTableOptions(); 
    

    createDataTable(tableOptions);
    $('.manage_user-id').append('<h1 class="admin-page-title">Invitation codes</h1>'
              +'<span class="table-info">Manage invitation codes. <a href=' + $('#add_new_link').val() + '>'
              +'Add new</a></span>');

    $('.table').on( 'draw.dt', function () {
        $("[rel=tooltip]").tooltip({ placement: 'top'});
          $('select.checkbox').multiselect({buttonWidth:200, numberDisplayed: 2, multiple: true, onChange: function(element, checked) {
            var form = $(element).closest("form");
            update_user(form);
          }
        });
        $('select.role').multiselect( { buttonWidth:80, onChange: function(element, checked) {
            var form = $(element).closest("form"); 
           update_user(form);
          }
        });
      });

   });
 


    function update_user(form){
       $(form).find(".loading").show();
      jQuery.ajax({
        type: "POST",
        dataType: 'json',
        data: $(form).serialize(),
        url:  $(form).attr('action'),
        success: function(data) {
          $(form).find(".loading").hide();
          $(form).find(".check").show();
        }.bind(this),
        error: function(error) {
            alert(error);
        }.bind(this),
        timeout: 30000
      });
    }

</script>

<%end%>



